<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="System Cascade Connection" href="system.html" /><link rel="prev" title="Bootleg Lambda Calculus" href="index.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><meta name="generator" content="sphinx-3.3.0, furo 2020.11.01.beta14"/>
        <title>Infinite Sequences: A Case Study in Functional Python - Raphael McSinyx</title>
      <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <link rel="stylesheet" type="text/css" href="../_static/fab.css" />
    <link rel="stylesheet" href="../_static/styles/default.css?ac370c360d79d595a27ab955">
    <link rel="stylesheet" href="../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #436e58;
  --color-brand-content: #436e58;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #436e58;
  --color-brand-content: #436e58;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #436e58;
  --color-brand-content: #436e58;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #436e58;
  --color-brand-content: #436e58;
  
  }
</style>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/scripts/main.js?ac370c360d79d595a27ab955"></script></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>


<div class="page">
  <header class="mobile-header">
    <label class="header-left nav-overlay-icon" for="__navigation">
      <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
    </label>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Raphael McSinyx</div></a>
    </div>
    <div class="header-right"></div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/CnX.png" alt="Logo"/>
  </div>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder="Search" name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll">
  <div class="sidebar-tree">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../works.html">Free Software Works</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../life/index.html">Meatspace Adventures</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../life/2010.html">Why the Name?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../life/2013.html">The Year after the Apocalypse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../life/2020.html">The 2020 Experience</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Bootleg Lambda Calculus</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Infinite Sequences: A Case Study in Functional Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="system.html">System Cascade Connection</a></li>
</ul>
</li>
</ul>

  </div>
  <div id="ethical-ad-placement"></div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="infinite-sequences-a-case-study-in-functional-python">
<h1>Infinite Sequences: A Case Study in Functional Python<a class="headerlink" href="#infinite-sequences-a-case-study-in-functional-python" title="Permalink to this headline">¶</a></h1>
<p>In this article, we will only consider sequences defined by a function
whose domain is a subset of the set of all integers.  Such sequences will be
<em>visualized</em>, i.e. we will try to evaluate the first few (thousand) elements,
using functional programming paradigm, where functions are more similar
to the ones in math (in contrast to imperative style with side effects
confusing to inexperenced coders).  The idea is taken from <a class="reference external" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-24.html#%_sec_3.5.2">subsection 3.5.2
of SICP</a> and adapted to Python, which, compare to Scheme, is significantly
more popular: Python is pre-installed on almost every modern Unix-like system,
namely macOS, GNU/Linux and the *BSDs; and even at MIT, the new 6.01 in Python
has recently replaced the legendary 6.001 (SICP).</p>
<p>One notable advantage of using Python is its huge <strong>standard</strong> library.
For example the <em>identity sequence</em> (sequence defined by the identity function)
can be imported directly from <code class="docutils literal notranslate"><span class="pre">itertools</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">count</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">positive_integers</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">positive_integers</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">positive_integers</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">positive_integers</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">3</span>
<span class="go">4</span>
<span class="go">5</span>
<span class="go">6</span>
</pre></div>
</div>
<p>To open a Python emulator, simply lauch your terminal and run <code class="docutils literal notranslate"><span class="pre">python</span></code>.
If that is somehow still too struggling, navigate to <a class="reference external" href="https://www.python.org/shell/">the interactive shell</a>
on Python.org</p>
<p><em>Let’s get it started</em> with somethings everyone hates: recursively defined
sequences, e.g. the famous Fibonacci (<span class="math notranslate nohighlight">\(F_n = F_{n-1} + F_{n-2}\)</span>,
<span class="math notranslate nohighlight">\(F_1 = 1\)</span> and <span class="math notranslate nohighlight">\(F_0 = 0\)</span>).  Since <a class="reference external" href="http://neopythonic.blogspot.com/2009/04/final-words-on-tail-calls.html">Python does not support</a>
<a class="reference external" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-11.html#call_footnote_Temp_48">tail recursion</a>, it’s generally <strong>not</strong> a good idea to define anything
recursively (which is, ironically, the only trivial <em>functional</em> solution
in this case) but since we will only evaluate the first few terms
(use the <strong>Tab</strong> key to indent the line when needed):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># To avoid making the code look complicated,</span>
<span class="gp">... </span>    <span class="c1"># n &lt; 0 is not handled here.</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fibo_seq</span> <span class="o">=</span> <span class="p">(</span><span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">fibo_seq</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0</span>
<span class="go">1</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">5</span>
<span class="go">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fibo_seq</span></code> above is just to demonstrate how <code class="docutils literal notranslate"><span class="pre">itertools.count</span></code>
can be use to create an infinite sequence defined by a function.
For better performance, this should be used instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci_sequence</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">a</span>
    <span class="k">yield from</span> <span class="n">fibonacci_sequence</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It is noticable that the elements having been iterated through (using <code class="docutils literal notranslate"><span class="pre">next</span></code>)
will disappear forever in the void (oh no!), but that is the cost we are
willing to pay to save some memory, especially when we need to evaluate a
member of (arbitrarily) large index to estimate the sequence’s limit.
One case in point is estimating a definite integral using <a class="reference external" href="https://en.wikipedia.org/wiki/Riemann_sum#Left_Riemann_sum">left Riemann sum</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">left_riemann_sum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
        <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">dx</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="k">return</span> <span class="n">left_riemann_sum</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">integral(f,</span> <span class="pre">a,</span> <span class="pre">b)</span></code> as defined above returns a function taking
<span class="math notranslate nohighlight">\(n\)</span> as an argument.  As <span class="math notranslate nohighlight">\(n\to\infty\)</span>, its result approaches
<span class="math notranslate nohighlight">\(\int_a^b f(x)\mathrm d x\)</span>.  For example, we are going to estimate
<span class="math notranslate nohighlight">\(\pi\)</span> as the area of a semicircle whose radius is <span class="math notranslate nohighlight">\(\sqrt 2\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">semicircle</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pi</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="n">semicircle</span><span class="p">,</span> <span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pi_seq</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">pi_seq</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">2.000000029802323</span>
<span class="go">2.514157464087051</span>
<span class="go">2.7320508224700384</span>
</pre></div>
</div>
<p>Whilst the first few aren’t quite close, at index around 1000,
the result is somewhat acceptable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">3.1414873191059525</span>
<span class="mf">3.1414874770617427</span>
<span class="mf">3.1414876346231577</span>
</pre></div>
</div>
<p>Since we are comfortable with sequence of sums, let’s move on to sums of
a sequence, which are called series.  For estimation, again, we are going to
make use of infinite sequences of partial sums, which are implemented as
<code class="docutils literal notranslate"><span class="pre">itertools.accumulate</span></code> by thoughtful Python developers.  <a class="reference external" href="https://en.wikipedia.org/wiki/Geometric_series">Geometric</a> and
<a class="reference external" href="https://math.oregonstate.edu/home/programs/undergrad/CalculusQuestStudyGuides/SandS/SeriesTests/p-series.html">p-series</a> can be defined as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">accumulate</span> <span class="k">as</span> <span class="n">partial_sums</span>

<span class="k">def</span> <span class="nf">geometric_series</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">partial_sums</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">p_series</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">partial_sums</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="o">**</span><span class="n">p</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>We can then use these to determine whether a series is convergent or divergent.
For instance, one can easily verify that the <span class="math notranslate nohighlight">\(p\)</span>-series with <span class="math notranslate nohighlight">\(p = 2\)</span>
converges to <span class="math notranslate nohighlight">\(\pi^2 / 6 \approx 1.6449340668482264\)</span> via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">p_series</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1.0</span>
<span class="go">1.25</span>
<span class="go">1.3611111111111112</span>
<span class="go">1.4236111111111112</span>
<span class="go">1.4636111111111112</span>
<span class="go">1.4913888888888889</span>
<span class="go">1.511797052154195</span>
<span class="go">1.527422052154195</span>
<span class="go">1.5397677311665408</span>
<span class="go">1.5497677311665408</span>
<span class="go">1.558032193976458</span>
</pre></div>
</div>
<p>We can observe that it takes quite a lot of steps to get the precision we would
generally expect (<span class="math notranslate nohighlight">\(s_{11}\)</span> is only precise to the first decimal place;
second decimal places: <span class="math notranslate nohighlight">\(s_{101}\)</span>; third: <span class="math notranslate nohighlight">\(s_{2304}\)</span>).
Luckily, many techniques for series acceleration are available.
<a class="reference external" href="https://en.wikipedia.org/wiki/Shanks_transformation">Shanks transformation</a> for instance, can be implemented as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span><span class="p">,</span> <span class="n">tee</span>

<span class="k">def</span> <span class="nf">shanks</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">z</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
               <span class="o">*</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tee</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="mi">3</span><span class="p">))))</span>
</pre></div>
</div>
<p>In the code above, <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z:</span> <span class="pre">(x*z</span> <span class="pre">-</span> <span class="pre">y*y)</span> <span class="pre">/</span> <span class="pre">(x</span> <span class="pre">+</span> <span class="pre">z</span> <span class="pre">-</span> <span class="pre">y*2)</span></code> denotes
the anonymous function <span class="math notranslate nohighlight">\((x, y, z) \mapsto \frac{xz - y^2}{x + z - 2y}\)</span>
and <code class="docutils literal notranslate"><span class="pre">map</span></code> is a higher order function applying that function to
respective elements of subsequences starting from index 1, 2 and 3 of <cite>seq</cite>.
On Python 2, one should import <code class="docutils literal notranslate"><span class="pre">imap</span></code> from <code class="docutils literal notranslate"><span class="pre">itertools</span></code> to get the same
<a class="reference external" href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazy</a> behavior of <code class="docutils literal notranslate"><span class="pre">map</span></code> on Python 3.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">shanks</span><span class="p">(</span><span class="n">p_series</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1.4500000000000002</span>
<span class="go">1.503968253968257</span>
<span class="go">1.53472222222223</span>
<span class="go">1.5545202020202133</span>
<span class="go">1.5683119658120213</span>
<span class="go">1.57846371882088</span>
<span class="go">1.5862455815659202</span>
<span class="go">1.5923993101138652</span>
<span class="go">1.5973867787856946</span>
<span class="go">1.6015104548459742</span>
</pre></div>
</div>
<p>The result was quite satisfying, yet we can do one step futher
by continuously applying the transformation to the sequence:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
<span class="gp">... </span> <span class="k">yield</span> <span class="nb">next</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<span class="gp">... </span> <span class="k">yield from</span> <span class="n">compose</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">shanks</span><span class="p">,</span> <span class="n">p_series</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1.0</span>
<span class="go">1.503968253968257</span>
<span class="go">1.5999812811165188</span>
<span class="go">1.6284732442271674</span>
<span class="go">1.6384666832276524</span>
<span class="go">1.642311342667821</span>
<span class="go">1.6425249569252578</span>
<span class="go">1.640277484549416</span>
<span class="go">1.6415443295058203</span>
<span class="go">1.642038043478661</span>
</pre></div>
</div>
<p>Shanks transformation works on every sequence (not just sequences of
partial sums).  Back to previous example of using left Riemann sum
to compute definite integral:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pi_seq</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">shanks</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">pi_seq</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">2.000000029802323</span>
<span class="go">2.978391111182236</span>
<span class="go">3.105916845397819</span>
<span class="go">3.1323116570377185</span>
<span class="go">3.1389379264270736</span>
<span class="go">3.140788413965646</span>
<span class="go">3.140921512857936</span>
<span class="go">3.1400282163913436</span>
<span class="go">3.1400874774021816</span>
<span class="go">3.1407097229603256</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">pi_seq</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="go">3.1415061302492413</span>
</pre></div>
</div>
<p>Now having series defined, let’s see if we can learn anything
about power series. Sequence of partial sums of power series
∑*c*&lt;sub&gt;*n*&lt;/sub&gt;(<em>x</em>-<em>a</em>)&lt;sup&gt;*n*&lt;/sup&gt; can be defined as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mul</span>

<span class="k">def</span> <span class="nf">power_series</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">partial_sums</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="n">start</span><span class="p">))))</span>
</pre></div>
</div>
<p>We can use this to compute functions that can be written as
<a class="reference external" href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">power_series</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="o">%</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">power_series</span><span class="p">(</span><span class="n">c</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">%</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">n</span><span class="o">%</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">power_series</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Amazing!  Let’s test ‘em!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">shanks</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># this should converges to 2.718281828459045</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1.0</span>
<span class="go">2.749999999999996</span>
<span class="go">2.718276515152136</span>
<span class="go">2.718281825486623</span>
</pre></div>
</div>
<p>Impressive, huh? For sine and cosine, series acceleration is not even necessary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span> <span class="k">as</span> <span class="n">PI</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0.5235987755982988</span>
<span class="go">0.5235987755982988</span>
<span class="go">0.49967417939436376</span>
<span class="go">0.49967417939436376</span>
<span class="go">0.5000021325887924</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="go">0.500000433432915</span>
</pre></div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="system.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">System Cascade Connection</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Bootleg Lambda Calculus</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
          <span class="copyright">Copyright &copy; 2018-2020, Nguyễn Gia Phong</span> |
          Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using
          <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
  </body>
</html>